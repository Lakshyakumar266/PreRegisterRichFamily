{% extends 'layout.html' %} {% block body %}
<div class="register_intigration">
  <div
    class="min-w-screen min-h-screen bg-[#892cdc] flex items-center justify-center px-5 py-5"
  >
    <div
      class="bg-gray-100 text-gray-500 rounded-3xl shadow-xl w-full overflow-hidden"
      style="max-width: 1000px"
    >
      <div class="md:flex w-full">
        <div class="md:block hidden md:w-1/2 bg-indigo-500">
          <img
            src="{{ url_for('static', filename='images/open.jpg') }}"
            alt=""
          />
        </div>

        <div class="w-full md:w-1/2 py-10 px-5 md:px-10">
          <div class="text-center mb-10">
            <h1 class="font-bold text-3xl text-gray-900">REGISTER</h1>
            <p>Register To Get Early Access, And Get BONUS Rewards</p>
          </div>
          <form method="post" onsubmit="return validateForm(event)">
            <div class="flex -mx-3">
              <div class="w-1/2 px-3 mb-5">
                <label for="" class="text-xs font-semibold px-1"
                  >First name</label
                >
                <div class="flex">
                  <div
                    class="w-10 z-10 pl-1 text-center pointer-events-none flex items-center justify-center"
                  >
                    <i
                      class="mdi mdi-account-outline text-gray-400 text-lg"
                    ></i>
                  </div>
                  <input
                    id="Fname"
                    type="text"
                    class="w-full -ml-10 pl-10 pr-3 py-2 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"
                    placeholder="John"
                    required
                  />
                </div>
              </div>
              <div class="w-1/2 px-3 mb-5">
                <label for="" class="text-xs font-semibold px-1"
                  >Last name</label
                >
                <div class="flex">
                  <div
                    class="w-10 z-10 pl-1 text-center pointer-events-none flex items-center justify-center"
                  >
                    <i
                      class="mdi mdi-account-outline text-gray-400 text-lg"
                    ></i>
                  </div>
                  <input
                    id="Lname"
                    type="text"
                    class="w-full -ml-10 pl-10 pr-3 py-2 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"
                    placeholder="Smith"
                    required
                  />
                </div>
              </div>
            </div>
            <div class="flex -mx-3">
              <div class="w-full px-3 mb-5">
                <label for="" class="text-xs font-semibold px-1">Email</label>
                <div class="flex">
                  <div
                    class="w-10 z-10 pl-1 text-center pointer-events-none flex items-center justify-center"
                  >
                    <i class="mdi mdi-email-outline text-gray-400 text-lg"></i>
                  </div>

                  <input
                    id="Email"
                    type="email"
                    class="w-5/6 mr-1 -ml-8 pl-10 pr-3 py-2 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"
                    placeholder="johnsmith@example.com"
                    required
                  />
                  <input
                    id="VerifyOtp"
                    type="button"
                    class="max-w-xs mx-auto bg-indigo-500 hover:bg-indigo-700 focus:bg-indigo-700 text-white rounded-lg px-3 py-1 font-semibold cursor-pointer"
                    value="Verify"
                  />

                  <input
                    id="Otp"
                    type="text"
                    disabled
                    class="w-1/5 disabled:opacity-75 ml-1 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"
                    placeholder="OTP"
                    required
                  />
                </div>
              </div>
            </div>

            <div class="flex -mx-3">
              <div class="w-full px-3 mb-4">
                <label for="" class="text-xs font-semibold px-1"
                  >Password</label
                >
                <div class="flex">
                  <div
                    class="w-10 z-10 pl-1 text-center pointer-events-none flex items-center justify-center"
                  >
                    <i class="mdi mdi-lock-outline text-gray-400 text-lg"></i>
                  </div>
                  <input
                    id="Password"
                    type="password"
                    class="w-full -ml-10 pl-10 pr-3 py-2 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"
                    placeholder="************"
                    required
                  />
                </div>
                <span id="PaymentWarning" class="text-amber-500 text-sm">
                  *Requires at least 8 characters, including at least one
                  lowercase letter, one uppercase letter, and one digit.
                </span>
              </div>
            </div>

            <div class="flex -mx-3">
              <div class="w-full px-3 mb-2">
                <label for="" class="text-xs font-semibold px-1"
                  >Payment Code</label
                >
                <div class="flex">
                  <div
                    class="w-10 z-10 pl-1 text-center pointer-events-none flex items-center justify-center"
                  >
                    <i class="mdi mdi-email-outline text-gray-400 text-lg"></i>
                  </div>

                  <input
                    id="PaymentCode"
                    type="text"
                    class="w-2/3 mr-1 -ml-9 pl-2 pr-3 py-2 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500 disabled:opacity-75"
                    placeholder="Pre registration Fee is ₹10."
                    disabled
                    required
                  />

                  <button
                    id="ModalBtn"
                    class="max-w-xs mx-auto bg-indigo-500 hover:bg-indigo-700 focus:bg-indigo-700 text-white rounded-lg px-3 py-1 flex text-center justify-center items-center font-semibold md:text-base text-xs"
                  >
                    <img
                      src="{{ url_for('static', filename='images/upi-icon.svg') }}"
                      alt=""
                      class="w-9"
                    />
                    PAY ₹10
                  </button>
                </div>
                <span
                  id="PaymentWarning"
                  class="text-amber-500 text-sm pl-2 invisible"
                  >Copy Your Payment Code For Tracking Your Account*</span
                >
              </div>
            </div>

            <div class="flex -mx-3">
              <div class="w-full px-6 mb-6">
                <label for="checkbox" class="block">
                  <input type="checkbox" id="checkbox" class="form-checkbox" />
                  <span class="ml-2"
                    >I accept the
                    <a href="/pollicy" class="text-blue-400">
                      terms and conditions
                    </a></span
                  >
                  and i am doing it by my own.
                </label>
              </div>
            </div>

            <div class="flex -mx-3">
              <div class="w-full px-3 mb-5">
                <input
                  id="RegisterBtn"
                  type="submit"
                  class="block w-full max-w-xs mx-auto bg-indigo-500 hover:bg-indigo-700 focus:bg-indigo-700 text-white rounded-lg px-3 py-3 font-semibold cursor-pointer"
                  value="REGISTER NOW"
                />
              </div>
            </div>
          </form>

          <div class="GoogleAccount flex items-center justify-center flex-col">
            <h1 class="text-lg">OR</h1>
            <div class="flex items-center justify-center">
              <a
                disabled
                class="flex items-center bg-white border border-gray-300 rounded-lg shadow-md px-6 py-2 text-sm font-medium text-gray-800 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-75"
              >
                <svg
                  class="h-6 w-6 mr-2"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  width="800px"
                  height="800px"
                  viewBox="-0.5 0 48 48"
                  version="1.1"
                >
                  <title>Google-color</title>
                  <desc>Created with Sketch.</desc>
                  <defs></defs>
                  <g
                    id="Icons"
                    stroke="none"
                    stroke-width="1"
                    fill="none"
                    fill-rule="evenodd"
                  >
                    <g
                      id="Color-"
                      transform="translate(-401.000000, -860.000000)"
                    >
                      <g
                        id="Google"
                        transform="translate(401.000000, 860.000000)"
                      >
                        <path
                          d="M9.82727273,24 C9.82727273,22.4757333 10.0804318,21.0144 10.5322727,19.6437333 L2.62345455,13.6042667 C1.08206818,16.7338667 0.213636364,20.2602667 0.213636364,24 C0.213636364,27.7365333 1.081,31.2608 2.62025,34.3882667 L10.5247955,28.3370667 C10.0772273,26.9728 9.82727273,25.5168 9.82727273,24"
                          id="Fill-1"
                          fill="#FBBC05"
                        ></path>
                        <path
                          d="M23.7136364,10.1333333 C27.025,10.1333333 30.0159091,11.3066667 32.3659091,13.2266667 L39.2022727,6.4 C35.0363636,2.77333333 29.6954545,0.533333333 23.7136364,0.533333333 C14.4268636,0.533333333 6.44540909,5.84426667 2.62345455,13.6042667 L10.5322727,19.6437333 C12.3545909,14.112 17.5491591,10.1333333 23.7136364,10.1333333"
                          id="Fill-2"
                          fill="#EB4335"
                        ></path>
                        <path
                          d="M23.7136364,37.8666667 C17.5491591,37.8666667 12.3545909,33.888 10.5322727,28.3562667 L2.62345455,34.3946667 C6.44540909,42.1557333 14.4268636,47.4666667 23.7136364,47.4666667 C29.4455,47.4666667 34.9177955,45.4314667 39.0249545,41.6181333 L31.5177727,35.8144 C29.3995682,37.1488 26.7323182,37.8666667 23.7136364,37.8666667"
                          id="Fill-3"
                          fill="#34A853"
                        ></path>
                        <path
                          d="M46.1454545,24 C46.1454545,22.6133333 45.9318182,21.12 45.6113636,19.7333333 L23.7136364,19.7333333 L23.7136364,28.8 L36.3181818,28.8 C35.6879545,31.8912 33.9724545,34.2677333 31.5177727,35.8144 L39.0249545,41.6181333 C43.3393409,37.6138667 46.1454545,31.6490667 46.1454545,24"
                          id="Fill-4"
                          fill="#4285F4"
                        ></path>
                      </g>
                    </g>
                  </g>
                </svg>
                <span>Continue with Google</span>
              </a>
            </div>
          </div>

          <div class="flex items-center justify-center flex-col mt-2">
            <p class="text-sm">
              Learn about our
              <a href="/paymentPolicy" class="text-blue-600 hover:text-blue-900"
                >Policies & Terms</a
              >
              about PRE-REGISTERATION.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex items-end justify-end fixed bottom-0 right-0 mb-4 mr-4 z-10">
    <div>
      <a
        title="Buy me a beer"
        href="https://www.buymeacoffee.com/scottwindon"
        target="_blank"
        class="block w-16 h-16 rounded-full transition-all shadow hover:shadow-lg transform hover:scale-110 hover:rotate-12"
      >
        <img
          class="object-cover object-center w-full h-full rounded-full"
          src="https://i.pinimg.com/originals/60/fd/e8/60fde811b6be57094e0abc69d9c2622a.jpg"
        />
      </a>
    </div>
  </div>
</div>

<!-- Main modal -->
<div
  id="ModalBack"
  class="fixed top-0 w-[100vw] h-[100vh] z-50 Modal bg-white/10 backdrop-blur-3xl hidden"
>
  <div
    id="PaymentModal"
    data-modal-backdrop="static"
    tabindex="-1"
    aria-hidden="false"
    class="fixed top-0 md:inset-x-1/3 z-50 md:w-3/5 w-full p-4 overflow-x-hidden overflow-y-auto h-[calc(100%-1rem)] max-h-full bg-red hidden"
  >
    <div class="relative md:w-3/5 w-full max-w-2xl max-h-full">
      <!-- Modal content -->
      <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
        <!-- Modal header -->
        <div
          class="flex items-start justify-between p-4 border-b rounded-t dark:border-gray-600"
        >
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
            PRE REGISTER
          </h3>
          <button
            type="button"
            class="crossBtn text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"
            data-modal-hide="PaymentModal"
          >
            <svg
              class="w-5 h-5"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
          </button>
        </div>
        <!-- Modal body -->
        <div class="p-6 space-y-6">
          <div class="md:block bg-indigo-500">
            <img
              src="{{ url_for('static', filename='images/MerchantQR.png') }}"
              alt=""
              class="h-[60vh] w-[100rem]"
            />
          </div>
        </div>
        <!-- Modal footer -->
        <div
          class="flex items-center p-6 space-x-2 border-t border-gray-200 rounded-b dark:border-gray-600"
        >
          <button
            id="VerifyPayment"
            data-modal-hide="ModalPayment"
            type="button"
            class="text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800"
          >
            Verify
          </button>
          <button
            data-modal-hide="PaymentModal"
            type="button"
            class="crossBtn text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-blue-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600"
          >
            Decline
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock body %} {% block script %}
<script>
  const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";

  function generateString(length) {
    let result = "";
    const charactersLength = characters.length;
    for (let i = 0; i < length; i++) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }

    return result;
  }

  const CrossBtn = document.getElementsByClassName("crossBtn");
  const ModalDiv = document.getElementById("ModalBack");
  const ModalPay = document.getElementById("PaymentModal");
  const ModalBtn = document.getElementById("ModalBtn");

  const VerifyBtn = document.getElementById("VerifyPayment");
  const PaymentCodeInp = document.getElementById("PaymentCode");
  const PaymentWarning = document.getElementById("PaymentWarning");

  ModalBtn.addEventListener("click", () => {
    ModalPay.classList.remove("hidden");
    ModalDiv.classList.remove("hidden");
  });
  for (btn of CrossBtn) {
    btn.addEventListener("click", () => {
      ModalPay.classList.add("hidden");
      ModalDiv.classList.add("hidden");
    });
  }

  VerifyBtn.addEventListener("click", () => {
    const date = new Date().getTime();

    const verifyString = `${generateString(5)}COD${date}PAY${generateString(
      5
    )}`;
    PaymentCodeInp.value = verifyString;

    PaymentWarning.classList.remove("invisible");
    ModalPay.classList.add("hidden");
    ModalDiv.classList.add("hidden");
  });
</script>

<script>
  var emailRegex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
  var email = document.getElementById("Email");
  document.getElementById("VerifyOtp").addEventListener("click", () => {
    // Validate Email
    if (!email.value.match(emailRegex)) {
      email.classList.add("border", "border-red-500");
      email.classList.remove("border-green-500");
      return false;
    } else {
      email.classList.remove("border", "border-red-500");
      email.classList.add("border", "border-green-500");
    }

    const data = {
      email: email,
      username: `${document.getElementById("Fname").value} ${
        document.getElementById("Lname").value
      }`,
    };
    console.log(data);
    fetch("/otphandle", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    })
      .then((response) => response.json())
      .then((data) => {
        console.log("Request Sended");
        console.log("Response:", data);
        document.getElementById("Otp").removeAttribute("disabled");
        document
          .getElementById("Otp")
          .classList.add(
            "bg-yellow-50",
            "border",
            "border-yellow-500",
            "text-yellow-900",
            "placeholder-yellow-700"
          );
      })
      .catch((error) => {
        console.error("Error:", error);
      });
  });
</script>

<script>
  function validateForm(event) {
    event.preventDefault(); // Prevent form submission from reloading the page

    var firstName = document.getElementById("Fname");
    var lastName = document.getElementById("Lname");
    var email = document.getElementById("Email");
    var otp = document.getElementById("Otp");
    var password = document.getElementById("Password");
    var paymentCode = document.getElementById("PaymentCode");
    var checkbox = document.getElementById("checkbox");
    var RegisterBtn = document.getElementById("RegisterBtn");

    // Regular expressions for validation
    var nameRegex = /^[a-zA-Z]+$/;
    var emailRegex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
    var otpRegex = /^\d{6}$/;
    var passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
    var paymentCodeRegex = /^[\d\w]{10,}$/;

    // Validate First Name
    if (!firstName.value.match(nameRegex)) {
      firstName.classList.add("border", "border-red-500");
      firstName.classList.remove("border-green-500");
      return false;
    } else {
      firstName.classList.remove("border", "border-red-500");
      firstName.classList.add("border", "border-green-500");
    }

    // Validate Last Name
    if (!lastName.value.match(nameRegex)) {
      lastName.classList.add("border", "border-red-500");
      lastName.classList.remove("border-green-500");
      return false;
    } else {
      lastName.classList.remove("border", "border-red-500");
      lastName.classList.add("border", "border-green-500");
    }

    // Validate Email
    if (!email.value.match(emailRegex)) {
      email.classList.add("border", "border-red-500");
      email.classList.remove("border-green-500");
      return false;
    } else {
      email.classList.remove("border", "border-red-500");
      email.classList.add("border", "border-green-500");
    }

    // Validate OTP
    if (!otp.value.match(otpRegex)) {
      otp.classList.remove(
        "bg-yellow-50",
        "border",
        "border-yellow-500",
        "text-yellow-900",
        "placeholder-yellow-700"
      );
      otp.classList.add("border", "border-red-500");
      otp.classList.remove("border-green-500");
      return false;
    } else {
      otp.classList.remove(
        "bg-yellow-50",
        "border",
        "border-yellow-500",
        "text-yellow-900",
        "placeholder-yellow-700"
      );
      otp.classList.add("border", "border-red-500");
      otp.classList.remove("border-green-500");
      otp.classList.remove("border", "border-red-500");
      otp.classList.add("border", "border-green-500");
    }

    // Validate Password
    if (!password.value.match(passwordRegex)) {
      password.classList.add("border", "border-red-500");
      password.classList.remove("border-green-500");
      return false;
    } else {
      password.classList.remove("border", "border-red-500");
      password.classList.add("border", "border-green-500");
    }

    // Validate Payment Code
    if (!paymentCode.value.match(paymentCodeRegex)) {
      paymentCode.classList.add("border", "border-red-500");
      paymentCode.classList.remove("border-green-500");
      return false;
    } else {
      paymentCode.classList.remove("border", "border-red-500");
      paymentCode.classList.add("border", "border-green-500");
    }

    if (!checkbox.checked) {
      alert("Please accept the terms and conditions.");
      return false;
    }

    // Form is valid, perform further actions (e.g., AJAX request)
    var url = "/registerhandle";

    // Define the form data
    var formData = new FormData();

    formData.append("username", `${firstName.value} ${lastName.value}`);
    formData.append("email", `${email.value}`);
    formData.append("otp", `${otp.value}`);
    formData.append("password", `${password.value}`);
    formData.append("paymentCode", `${paymentCode.value}`);

    // Send the POST request
    fetch(url, {
      method: "POST",
      body: formData,
    })
      .then(function (response) {
        if (response.ok) {
          return response.text();
        }
        throw new Error("Request failed.");
      })
      .then(function (data) {
        let params = JSON.parse(data);
        console.log(JSON.parse(data));
        if (params["error"]) {
          // error Found
          console.log("error");
          console.log(params["error"]);
        } else {
          if (params["verification"]) {
            console.log("MUCK");
            // redirect
          } else {
            otp.classList.remove(
              "bg-yellow-50",
              "border",
              "border-yellow-500",
              "text-yellow-900",
              "placeholder-yellow-700"
            );
            otp.classList.add("border", "border-red-500");
            otp.classList.remove("border-green-500");
            return false;
          }
        }
      })
      .catch(function (error) {
        console.log(error); // Handle the error
      });
    // Additional code for form submission or further actions
    return true;
  }
</script>
{% endblock script %}
